#pragma once

#include <string>
#include <map>
#include <vector>
#include <cstdint>
#include <cstring>

class DFscript

{
public:
	const std::string binaryScriptToText(uint8_t* container);
	int32_t TextScriptToBinary(uint8_t*& dest, uint32_t& dataLength, const std::string& script);

private:

	enum scriptIDs {
		STRING = 3,
		INTEGER,
		VARIABLE,
		BREAK,
	};

	enum scriptErr {
		NOERRORS,
		ERRBADSTRFORMAT
	};

	struct Segment {
		uint16_t cmd = 0;
		uint32_t info = 0;
		uint16_t unknown = 0;	// no idea, seems always empty

		// not part of the original 8 byte segments! Only used for interpreter
		int32_t stringIndex = -1;
	};
	Segment seg;

	uint16_t getCmdID(const std::string& command);
	inline void checkLastCommand(std::vector<Segment>& seg, std::vector<std::string>& strs, std::string& lastCmd);

	// based on DreamFactory version 4.0 !
	const std::map<int32_t, std::string> ScriptCommands{
		{8001, "+"},
		{8002, "-"},
		{8003, "*"},
		{8004, "/"},
		{8005, "&"},
		{8006, "|"},
		{8007, "@"},
		{8008, "="},
		{8009, "!="},
		{8010, ">"},
		{8011, "<"},
		{8012, ">="},
		{8013, "<="},
		{4018, "("},
		{4019, ")"},
		{4020, ","},
		{12015, "actorscript"},
		{16036, "actorturn"},
		{16002, "actordeg"},
		{16012, "actordist"},
		{16005, "actoris3d"},
		{16014, "actorpose"},
		{16024, "actorscale"},
		{16021, "actorset"},
		{16023, "actorspeed"},
		{16006, "actorstar"},
		{16001, "actorvisible"},
		{16004, "actorxy"},
		{16003, "actorxyz"},
		{12075, "actorinstance"},
		{20083, "actionframe"},
		{16044, "actorvalue"},
		{16043, "actorowner"},
		{16051, "actorzclip"},
		{20023, "actorexists"},
		{12085, "actorwarm"},
		{12093, "actordelete"},
		{12104, "actorhide"},
		{12107, "actorlock"},
		{24001, "barndoorclose"},
		{24002, "barndooropen"},
		{12051, "blackscreen"},
		{12049, "blacktoscreen"},
		{12031, "bootscript"},
		{12025, "bothsound"},
		{20005, "button"},
		{12065, "buttonscript"},
		{4011, "case"},
		{16035, "camerahi"},
		{12047, "castscript"},
		{12014, "closecastfile"},
		{12042, "closepuppetfile"},
		{12033, "closesetfile"},
		{12057, "closeshopfile"},
		{12020, "closetrackfile"},
		{12061, "closestagefile"},
		{4001, "code"},
		{12038, "clut"},
		{16011, "currentview"},
		{12039, "cursor"},
		{20012, "countactors"},
		{20044, "countbuttons"},
		{20029, "countcasts"},
		{20035, "countflats"},
		{20031, "countprops"},
		{16029, "currentscene"},
		{20046, "countpuppets"},
		{20019, "countscenes"},
		{20033, "countshops"},
		{20018, "countpaintings"},
		{20014, "countsounds"},
		{20053, "currentset"},
		{20038, "currentflat"},
		{20051, "countglobals"},
		{20060, "commandkey"},
		{20049, "currentpuppet"},
		{20061, "calcvectx"},
		{20062, "calcvecty"},
		{20063, "cameraxyz"},
		{20048, "currentstage"},
		{20071, "calcdeg"},
		{20072, "calcturn"},
		{20075, "counttracks"},
		{20077, "currentsound"},
		{20079, "currenttheme"},
		{20078, "currentvoice"},
		{20081, "calcdist"},
		{16031, "currentdeg"},
		{20104, "countcrickets"},
		{20106, "countwalks"},
		{20107, "countbevels"},
		{12088, "castwarm"},
		{16034, "currentcd"},
		{20082, "calcmod"},
		{20118, "countviews"},
		{12110, "castlock"},
		{20105, "countloops"},
		{12080, "drawstring"},
		{12040, "debugger"},
		{12004, "delay"},
		{4029, "dumpglobal"},
		{4028, "dumplocal"},
		{12024, "dualsound"},
		{4008, "else"},
		{4004, "endcode"},
		{4015, "endfor"},
		{4007, "endif"},
		{4010, "endswitch"},
		{4017, "endwhile"},
		{12053, "error"},
		{12008, "exportclut"},
		{4005, "exitcode"},
		{4022, "false"},
		{12064, "flatscript"},
		{20037, "flattoindex"},
		{12073, "flushevents"},
		{4012, "for"},
		{16022, "framerate"},
		{20054, "findword"},
		{20067, "fileexists"},
		{20074, "frame"},
		{20027, "freemem"},
		{12052, "forceupdate"},
		{4002, "global"},
		{12062, "gotoflat"},
		{12028, "haltsound"},
		{12029, "halttheme"},
		{12030, "haltvoice"},
		{20121, "heapsize"},
		{20070, "hittest"},
		{12002, "hidecursor"},
		{4006, "if"},
		{20119, "indextoview"},
		{20013, "indextoactor"},
		{20022, "indextopainting"},
		{20045, "indextobutton"},
		{20030, "indextocast"},
		{20036, "indextoflat"},
		{20032, "indextoprop"},
		{20047, "indextopuppet"},
		{20020, "indextoscene"},
		{20034, "indextoshop"},
		{20015, "indextosound"},
		{24003, "irisclose"},
		{24004, "irisopen"},
		{20011, "iscricket"},
		{20010, "isloop"},
		{20009, "iswalk"},
		{20076, "indextotrack"},
		{20052, "indextoglobal"},
		{20102, "indextoloop"},
		{20103, "indextowalk"},
		{20101, "indextocricket"},
		{1, " "},
		{16045, "keyaborts"},
		{4003, "local"},
		{12007, "makecricket"},
		{20004, "makepoint"},
		{12001, "message"},
		{20006, "mouse"},
		{12023, "multiplesound"},
		{4026, "me"},
		{20065, "machinetype"},
		{20066, "machinespeed"},
		{16037, "menuvisible"},
		{12082, "mixclut"},
		{12005, "makeloop"},
		{4023, "not"},
		{12079, "notedialog"},
		{20026, "numtostring"},
		{12095, "netconnect"},
		{12096, "netdisconnect"},
		{20110, "networkon"},
		{20111, "netcountmembers"},
		{20112, "netindextomember"},
		{20113, "netourid"},
		{20114, "netmessagesender"},
		{20115, "netmessagegroup"},
		{12097, "netbroadcast"},
		{12098, "netjoingroup"},
		{24019, "nodraw"},
		{12099, "netleavegroup"},
		{12013, "opencastfile"},
		{12018, "openpuppetfile"},
		{12032, "opensetfile"},
		{12056, "openshopfile"},
		{12019, "opentrackfile"},
		{12060, "openstagefile"},
		{20058, "optionkey"},
		{12078, "opengame"},
		{4025, "passcode"},
		{24014, "plain"},
		{12017, "playmovie"},
		{12021, "playtheme"},
		{20039, "pointinactor"},
		{20017, "pointinpainting"},
		{20043, "pointinbutton"},
		{20040, "pointinprop"},
		{20041, "pointinset"},
		{20042, "pointinstage"},
		{20002, "pointx"},
		{20003, "pointy"},
		{16009, "path"},
		{16016, "propdeg"},
		{12105, "prophide"},
		{16013, "propdist"},
		{16019, "propis3d"},
		{16028, "propscale"},
		{16027, "propset"},
		{16026, "propspeed"},
		{16020, "propstar"},
		{16025, "propview"},
		{16015, "propvisible"},
		{16018, "propxy"},
		{16017, "propxyz"},
		{12054, "propscript"},
		{12044, "puppetbevel"},
		{12041, "puppetclear"},
		{20028, "puppetevent"},
		{12046, "puppetscript"},
		{20057, "putword"},
		{12074, "puppetgrab"},
		{16053, "puppetbase"},
		{20064, "playerxyz"},
		{12043, "puppetspeak"},
		{12076, "propinstance"},
		{12027, "plugin"},
		{20098, "pluginfx"},
		{16042, "propvalue"},
		{16032, "propowner"},
		{16046, "pauseloop"},
		{16048, "pausewalk"},
		{16049, "puppetparam"},
		{16050, "puppetvisible"},
		{12083, "puppetscramble"},
		{12084, "puppetsubtitle"},
		{16052, "propzclip"},
		{12086, "propwarm"},
		{12037, "paintingscript"},
		{12089, "postscript"},
		{20024, "propexists"},
		{20109, "pluginexists"},
		{12094, "propdelete"},
		{12108, "proplock"},
		{16047, "pausecricket"},
		{20068, "questiondialog"},
		{12071, "quit"},
		{20001, "random"},
		{4024, "return"},
		{20116, "roadahead"},
		{12106, "reboot"},
		{16010, "result"},
		{12036, "scenescript"},
		{20090, "sendtopaintingfx"},
		{12050, "screentoblack"},
		{24005, "scrolldown"},
		{24008, "scrolleft"},
		{24007, "scrollright"},
		{24006, "scrollup"},
		{12016, "sendtoactor"},
		{12068, "sendtobutton"},
		{12048, "sendtocast"},
		{12069, "sendtoflat"},
		{12055, "sendtoprop"},
		{12045, "sendtopuppet"},
		{12034, "sendtoscene"},
		{12067, "sendtoset"},
		{12059, "sendtoshop"},
		{12070, "sendtostage"},
		{12035, "setscript"},
		{16007, "setvisible"},
		{16008, "stagevisible"},
		{12058, "shopscript"},
		{12003, "showcursor"},
		{12022, "singlesound"},
		{20016, "sounddone"},
		{12063, "stagescript"},
		{4014, "step"},
		{20007, "stilldown"},
		{12012, "stopcricket"},
		{12011, "stoploop"},
		{12010, "stopwalk"},
		{20025, "stringtonum"},
		{20056, "stringlength"},
		{20059, "shiftkey"},
		{20055, "substring"},
		{12077, "savegame"},
		{20073, "starxyz"},
		{20096, "scenexyz"},
		{12081, "sendtoboot"},
		{16040, "soundvol"},
		{16038, "soundpan"},
		{16039, "soundloop"},
		{20080, "soundrate"},
		{4009, "switch"},
		{20084, "sendtoactorfx"},
		{20092, "sendtobuttonfx"},
		{20087, "sendtocastfx"},
		{20093, "sendtoflatfx"},
		{20088, "sendtopropfx"},
		{20086, "sendtopuppetfx"},
		{20085, "sendtoscenefx"},
		{20091, "sendtosetfx"},
		{20089, "sendtoshopfx"},
		{20094, "sendtostagefx"},
		{12066, "sendtopainting"},
		{20095, "sendtobootfx"},
		{20021, "sendtopostfx"},
		{20100, "sendtoserverfx"},
		{12087, "shopwarm"},
		{12090, "sendtopost"},
		{12092, "sendtoserver"},
		{12091, "serverscript"},
		{20117, "stringwidth"},
		{12109, "shoplock"},
		{16055, "setparam"},
		{16056, "stageparam"},
		{20120, "sysmem"},
		{20108, "sqrt"},
		{4013, "to"},
		{20050, "type"},
		{20008, "tick"},
		{20069, "textdialog"},
		{12072, "turntodeg"},
		{16041, "themevol"},
		{16054, "themepan"},
		{4027, "target"},
		{24016, "turnleft"},
		{24015, "turnright"},
		{24017, "turnup"},
		{24018, "turndown"},
		{24020, "turnhalfleft"},
		{24021, "turnhalfright"},
		{4021, "true"},
		{24009, "venetian"},
		{12009, "visualeffect"},
		{12026, "voicesound"},
		{20097, "voicedone"},
		{16030, "variable"},
		{12006, "walktostar"},
		{20099, "walkdest"},
		{4016, "while"},
		{24010, "wipedown"},
		{24013, "wipeleft"},
		{24012, "wiperight"},
		{16033, "wavevolume"},
		{12100, "walkonpath"},
		{12101, "walktoxyz"},
		{12102, "walkonroad"},
		{12103, "walkonframes"},
		{24011, "wipeup"}
	};
};


